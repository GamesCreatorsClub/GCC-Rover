#!/usr/bin/env python3

import sys
import time
import pyroscommon as pc


args = pc.processCommonHostSwitches(pc.args)

def help(rc):
    print("usage: pyros [<host[:port]] ps [<options>]")
    print("")
    print("    -h                    help message")
    sys.exit(rc)

if pc.help:
    help(0)


def processLine(line):
    if line.endswith("\n"):
        line = line[:len(line) - 1]

    split = line.split(" ")
    if len(split) >= 5:
        try:
            l = int(split[4])
            if l >= 2 * 1024 * 1024 * 1024:
                ll = str(round(l / (1024.0 * 1024.0 * 1024.0), 3)) + "GB"
            elif l > 2 * 1024 * 1024:
                ll = str(round(l / (1024.0 * 1024.0), 3)) + "MB"
            elif l > 2 * 1024:
                ll = str(round(l / 1024.0, 3)) + "KB"
            else:
                ll = str(l) + "B"
            split[4] = ll
        except:
            pass

    if len(split) == 6:
        try:
            t = float(split[5])
            split[5] = "\"" + time.ctime(t) + "\""
        except:
            pass

    # print("split=" + str(split))
    print("{0!s:<15} {1:<10} {2:<10} {3:<7} {4:<10} {5:<15}".format(*split))

pc.printOutCommand("ps", processLine,
                   "{0:<15} {1:<10} {2:<10} {3:<7} {4:<10} {5:<15}".format(
                       "name", "type", "status", "rc", "len", "date"), "")


